(function(C,me){typeof exports=="object"&&typeof module!="undefined"?module.exports=me():typeof define=="function"&&define.amd?define(me):(C=typeof globalThis!="undefined"?globalThis:C||self,C.VertigoUi=me())})(this,function(){"use strict";var C=(e,t)=>{const o=e.__vccOpts||e;for(const[a,s]of t)o[a]=s;return o};const me={props:{botUrl:{type:String,required:!0},devMode:{type:Boolean,default:!1},minTimeBetweenMessages:{type:Number,default:1e3},botAvatar:{type:String,required:!0},botName:{type:String,required:!0}},data:function(){return{convId:42,inputConfig:{modeTextarea:!1,responseText:"",responsePattern:"",showRating:!1,rating:0,buttons:[]},prevInputConfig:{},lastPayload:null,processing:!1,error:!1,messages:[],keepAction:!1,menu:!1,lastUserInteraction:0,watingMessagesStack:[]}},created:function(){this.askBot("/start"),this.convId=Math.random()},methods:{postAnswerBtn:function(e){this.messages.push({text:[e.title],sent:!0,bgColor:"primary",textColor:"white"}),this._scrollToBottom(),this.askBot(e.payload)},postAnswerText:function(){var e=this.inputConfig.responseText.trim().replace(/(?:\r\n|\r|\n)/g,"<br>");this.messages.push({text:e!==""?[e]:null,rating:this.inputConfig.rating>0?this.inputConfig.rating:null,sent:!0,bgColor:"primary",textColor:"white"}),this._scrollToBottom();var t=this.inputConfig.responsePattern===""?e.replace(/(")/g,'"'):this.inputConfig.responsePattern.replace("#",e.replace(/(")/g,'\\"'));this.askBot(t)},_scrollToBottom:function(){this.$refs.scroller&&this.$refs.scroller.setScrollPosition(this.$refs.scroller.scrollHeight,400)},askBot:function(e){this.prevInputConfig=JSON.parse(JSON.stringify(this.inputConfig)),this.reinitInput(),this.lastPayload=e,this.processing=!0,this.lastUserInteraction=Date.now(),this.$http.post(this.botUrl,{sender:this.convId,message:e}).then(function(t){t.data.forEach(function(o){this.watingMessagesStack.push(o)},this),this._displayMessages()}.bind(this)).catch(function(){this.error=!0,this.processing=!1,this._scrollToBottom()}.bind(this))},_displayMessages:function(){if(this.watingMessagesStack.length>0){var e=this.watingMessagesStack.shift(),t=this.lastUserInteraction-Date.now()+this.minTimeBetweenMessages;this.sleep(t).then(function(){this._processResponse(e),this.lastUserInteraction=Date.now(),this._displayMessages()}.bind(this))}else this.processing=!1,this.keepAction&&(this.inputConfig=this.prevInputConfig,this.inputConfig.responseText="",this.keepAction=!1),this.sleep(1).then(function(){this.$refs.input.focus()}.bind(this))},_processResponse:function(e){var t=this.messages[this.messages.length-1];t&&!t.sent?t.text.push(e.text):this.messages.push({avatar:this.botAvatar,text:[e.text],bgColor:"grey-4"}),e.buttons&&e.buttons.forEach(function(o){if(o.title.startsWith("#")){var a=o.title.substring(1);a==="textarea"&&(this.inputConfig.modeTextarea=!0),a==="eval"&&(this.inputConfig.showRating=!0),a==="keep_action"&&(this.keepAction=!0),o.payload&&(this.inputConfig.responsePattern=o.payload)}else this.inputConfig.buttons.push(o)},this),this._scrollToBottom()},restart:function(){this.messages.push({text:[this.$q.lang.vui.chatbot.restartMessage],bgColor:"orange"}),this._scrollToBottom(),this.$http.post(this.botUrl,'{"sender":"'+this.convId+'","message":"/restart"}').then(function(){this.askBot("/start")}.bind(this))},reinitInput:function(){this.inputConfig.modeTextarea=!1,this.inputConfig.responsePattern="",this.inputConfig.responseText="",this.inputConfig.showRating=!1,this.inputConfig.rating=0,this.inputConfig.buttons=[],this.error=!1},sleep:function(e){return new Promise(function(t){setTimeout(t,e)})}}},Je=window.Vue.renderList,Xe=window.Vue.Fragment,L=window.Vue.openBlock,be=window.Vue.createElementBlock,re=window.Vue.resolveComponent,oe=window.Vue.createVNode,le=window.Vue.withCtx,G=window.Vue.createBlock,ne=window.Vue.createCommentVNode,We=window.Vue.toDisplayString,I=window.Vue.createElementVNode,gt=window.Vue.withKeys,wt={class:"bot"},_t={class:"q-pr-md"},vt={class:"sys-chat"},$t={class:"q-pb-sm"},bt={class:"sys-chat non-selectable"},yt={class:"text-blue-2 q-caption"},Vt={class:"row docs-btn"},Ct={class:"message-processing sys-chat non-selectable"},kt={class:"non-selectable"},qt={class:"message-response row docs-btn q-pl-sm non-selectable"};function St(e,t,o,a,s,n){const i=re("q-rating"),r=re("q-chat-message"),l=re("q-btn"),c=re("q-spinner-dots"),p=re("q-scroll-area"),f=re("q-input");return L(),be("div",wt,[oe(p,{class:"bg-grey-2 col-grow row q-pa-sm",ref:"scroller"},{default:le(()=>[I("div",_t,[(L(!0),be(Xe,null,Je(e.messages,(u,h)=>(L(),be("div",{key:h},[u.rating?(L(),G(r,{class:"animate-fade",key:"msgRating-"+h,sent:u.sent,"bg-color":u.bgColor,avatar:u.avatar},{default:le(()=>[oe(i,{modelValue:u.rating,"onUpdate:modelValue":d=>u.rating=d,max:5,style:{"font-size":"2rem"},readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["sent","bg-color","avatar"])):ne("",!0),u.text?(L(),G(r,{class:"animate-fade",key:"msg-"+h,label:u.label,sent:u.sent,"text-color":u.textColor,"bg-color":u.bgColor,name:u.name,avatar:u.avatar,text:u.text,stamp:u.stamp},null,8,["label","sent","text-color","bg-color","name","avatar","text","stamp"])):ne("",!0)]))),128)),I("div",vt,[e.error?(L(),G(r,{key:0,class:"animate-fade","bg-color":"orange-4","text-color":"black",size:"12"},{default:le(()=>[I("div",$t,We(e.$q.lang.vui.chatbot.errorMessage),1),oe(l,{class:"full-width",onClick:t[0]||(t[0]=u=>n.askBot(e.lastPayload)),label:e.$q.lang.vui.chatbot.tryAgain,color:"white","text-color":"black"},null,8,["label"])]),_:1})):ne("",!0)]),I("div",bt,[e.inputConfig.buttons.length>0?(L(),G(r,{key:0,class:"animate-fade","bg-color":"primary",size:"12"},{default:le(()=>[I("div",yt,We(e.$q.lang.vui.suggestedAnswers),1),I("div",Vt,[(L(!0),be(Xe,null,Je(e.inputConfig.buttons,(u,h)=>(L(),G(l,{class:"full-width",key:"repChatBtn-"+h,onClick:d=>n.postAnswerBtn(u),label:u.title,color:"white","text-color":"black"},null,8,["onClick","label"]))),128))])]),_:1})):ne("",!0)]),I("div",Ct,[e.processing?(L(),G(r,{key:0,class:"animate-fade","bg-color":"grey-4"},{default:le(()=>[oe(c,{size:"2em"})]),_:1})):ne("",!0)]),I("div",kt,[e.inputConfig.showRating?(L(),G(r,{key:0,class:"animate-fade","bg-color":"primary",sent:""},{default:le(()=>[oe(i,{modelValue:e.rating,"onUpdate:modelValue":t[1]||(t[1]=u=>e.rating=u),max:4,style:{"font-size":"2rem"}},null,8,["modelValue"])]),_:1})):ne("",!0)])])]),_:1},512),I("div",qt,[oe(f,{type:e.inputConfig.modeTextarea?"textarea":"text",ref:"input",onKeyup:t[2]||(t[2]=gt(u=>e.inputConfig.modeTextarea||e.inputConfig.responseText.trim()===""&&e.inputConfig.rating===0?!1:n.postAnswerText(),["enter"])),"max-height":100,class:"col-grow",modelValue:e.inputConfig.responseText,"onUpdate:modelValue":t[3]||(t[3]=u=>e.inputConfig.responseText=u),placeholder:e.$q.lang.vui.chatbot.inputPlaceholder,disable:e.processing||e.error,loading:e.processing},null,8,["type","modelValue","placeholder","disable","loading"]),oe(l,{round:"",color:"primary",icon:"send",onClick:t[4]||(t[4]=u=>n.postAnswerText()),disable:e.processing||e.inputConfig.responseText.trim()===""&&e.inputConfig.rating===0},null,8,["disable"]),o.devMode===!0?(L(),G(l,{key:0,round:"",color:"red",icon:"refresh",onClick:n.restart},null,8,["onClick"])):ne("",!0)])])}var Dt=C(me,[["render",St]]);const xt={data:function(){return{text:"",commandParamsValues:[],commands:[],commandAutocompleteOptions:[],isCommandCommited:!1,selectedCommand:{},isExecuted:!1,commandResult:{},paramsAutocompleteOptions:[]}},props:{baseUrl:{type:String,default:"/"}},methods:{searchCommands:function(e,t,o){if(this.$data.text=e,this.$data.selectedCommand={},e.length<1){o();return}this.$http.post(this.baseUrl+"api/vertigo/commands/_search",{prefix:e}).then(function(a){this.$data.commands=a.data,t(function(){this.$data.commandAutocompleteOptions=this.$data.commands.map(function(s){return{label:s.commandName,sublabel:s.descpription,value:s.commandName,command:s}})}.bind(this)),this.$data.commands.length>0&&this.chooseCommand(this.$data.commands[0],!1)}.bind(this))},selectCommand:function(e){this.chooseCommand(e.command,!0)},chooseCommand:function(e,t){this.$data.selectedCommand=e,this.$data.selectedCommand.commandParams?this.$data.commandParamsValues=this.$data.selectedCommand.commandParams.map(function(){return{value:""}}):this.$data.commandParamsValues=[],this.$data.isCommandCommited=t},commitCommand:function(e){if(this.$data.selectedCommand&&this.$data.selectedCommand.commandName)switch(e.keyCode){case 9:case 13:this.$data.isCommandCommited=!0,e.preventDefault()}},executeCommand:function(){if(this.$data.commandParamsValues.every(function(t){return t})){var e=this.$data.commandParamsValues.map(function(t){return t.value});this.$http.post(this.baseUrl+"api/vertigo/commands/_execute",{command:this.$data.selectedCommand.commandName,params:e}).then(function(t){this.$data.isExecuted=!0,this.$data.commandResult=t.data}.bind(this))}else return!1},handleEnter:function(e){e===this.$data.selectedCommand.commandParams.length-1&&this.$data.commandParamsValues[e].value&&this.executeCommand()},autocompleteParam:function(e,t,o,a,s){if(o.length<1){s();return}this.$http.get(this.baseUrl+"api/vertigo/commands/params/_autocomplete",{params:{terms:o,entityClass:e.paramType.actualTypeArguments[0]}}).then(function(n){a(function(){var i=this.$data.paramsAutocompleteOptions.slice();i[t]=n.data.map(function(r){return{label:r.label,value:r.urn}}),this.$data.paramsAutocompleteOptions=i}.bind(this))}.bind(this))},selectParam:function(e,t){var o=this.$data.commandParamsValues.slice();o[t]=e,this.$data.commandParamsValues=o},getParamValue(e){var t=this.$data.commandParamsValues[e];if(t&&t.value)return t},backIfNeeded:function(e,t){t&&!this.$data.commandParamsValues[0].value&&this.back()},back:function(){this.$data.commandParamsValues=[],this.$data.commands=[],this.$data.isCommandCommited=!1,this.$data.selectedCommand={},this.$data.isExecuted=!1,this.$data.commandResult={},this.$data.paramsAutocompleteOptions=[],this.$nextTick(function(){this.$refs.commandInput.updateInputValue(this.$data.text)})},reset:function(){this.back(),this.$data.text=""}}},fe=window.Vue.toDisplayString,U=window.Vue.openBlock,J=window.Vue.createElementBlock,Ke=window.Vue.createCommentVNode,ye=window.Vue.resolveComponent,Ze=window.Vue.withCtx,Ve=window.Vue.createBlock,et=window.Vue.createElementVNode,Ft=window.Vue.renderList,tt=window.Vue.Fragment,ce=window.Vue.withKeys,Ne=window.Vue.createVNode,Et=window.Vue.createTextVNode,Tt={key:0,style:{"line-height":"40px",opacity:"0.5",position:"fixed"}},Bt={class:"bg-grey-4 text-center vertical-middle text-bold q-px-md",style:{"line-height":"40px"}},Lt={key:0,class:"row col items-center q-py-xs"},Ut={key:1,class:"col"},Ot={key:1,class:"row col items-center"},Pt={class:"col shadow-2 bg-secondary text-white q-px-md",style:{"line-height":"40px"}};function Nt(e,t,o,a,s,n){const i=ye("q-select"),r=ye("q-input"),l=ye("q-separator"),c=ye("q-btn");return U(),J("div",null,[e.isCommandCommited?(U(),J("div",{key:1,class:"row col-12 justify-between bg-white round-borders overflow-hidden shadow-2 text-black",onKeyup:t[0]||(t[0]=ce((...p)=>n.executeCommand&&n.executeCommand(...p),["enter"]))},[et("div",Bt,fe(e.selectedCommand.commandName),1),e.isExecuted?(U(),J("div",Ot,[et("div",Pt,fe(e.commandResult.display),1),e.commandResult.targetUrl?(U(),Ve(c,{key:0,type:"a",href:o.baseUrl+e.commandResult.targetUrl,flat:""},{default:Ze(()=>[Et(fe(e.$q.lang.vui.commands.linkLabel),1)]),_:1},8,["href"])):Ke("",!0),Ne(c,{onClick:n.reset,flat:"",icon:"cancel",size:"sm",round:""},null,8,["onClick"])])):(U(),J("div",Lt,[e.selectedCommand.commandParams&&e.selectedCommand.commandParams.length>0?(U(!0),J(tt,{key:0},Ft(e.selectedCommand.commandParams,(p,f)=>(U(),J(tt,{key:p},[p.paramType.rawType==="io.vertigo.commons.command.GenericUID"?(U(),Ve(i,{key:0,class:"col q-px-xs","use-chips":"","bg-color":"white",dense:"",borderless:"","use-input":"","input-debounce":"300",value:n.getParamValue(f),options:e.paramsAutocompleteOptions[f],autofocus:f===0,"dropdown-icon":"search",onKeydown:ce(function(u){n.backIfNeeded(u,f===0)},["delete"]),onKeyup:ce(function(u){n.backIfNeeded(u,f===0)},["esc"]),onFilter:u=>n.autocompleteParam(p,f,e.val,e.update,e.abort),"onUpdate:modelValue":u=>n.selectParam(e.newValue,f),style:{height:"32px"}},null,8,["value","options","autofocus","onKeydown","onKeyup","onFilter","onUpdate:modelValue"])):(U(),Ve(r,{key:1,class:"col q-px-xs",color:"secondary",borderless:"",modelValue:e.commandParamsValues[f].value,"onUpdate:modelValue":u=>e.commandParamsValues[f].value=u,onKeydown:ce(u=>n.backIfNeeded(e.event,f===0),["delete"]),onKeyup:[ce(u=>n.backIfNeeded(e.event,f===0),["esc"]),ce(u=>n.handleEnter(f),["enter"])],autofocus:f===0,dense:"",style:{height:"32px"}},null,8,["modelValue","onUpdate:modelValue","onKeydown","onKeyup","autofocus"])),Ne(l,{vertical:""})],64))),128)):(U(),J("div",Ut,fe(e.$q.lang.vui.commands.executeCommand),1)),Ne(c,{onClick:n.executeCommand,flat:"",icon:"play_arrow",size:"sm",round:""},null,8,["onClick"])]))],32)):(U(),Ve(i,{key:0,placeholder:e.$q.lang.vui.commands.globalPlaceholder,outlined:"","bg-color":"white",dense:"",ref:"commandInput",autofocus:"","dropdown-icon":"search",onBlur:n.reset,"use-input":"","input-debounce":"300","hide-selected":"",onKeydown:n.commitCommand,options:e.commandAutocompleteOptions,onFilter:n.searchCommands,"onUpdate:modelValue":n.selectCommand},{default:Ze(()=>[e.text!==""&&e.selectedCommand.commandName&&e.selectedCommand.commandName.startsWith(e.text)?(U(),J("span",Tt,fe(e.selectedCommand.commandName),1)):Ke("",!0)]),_:1},8,["placeholder","onBlur","onKeydown","options","onFilter","onUpdate:modelValue"]))])}var Mt=C(xt,[["render",Nt]]);const Me=window.Quasar,At={props:{concept:{type:String},id:{type:String},icon:{type:String,default:"comment"},iconNone:{type:String,default:"add_comment"},baseUrl:{type:String,default:"/api/",required:!0},connectedAccount:{type:String}},data:function(){return{list:[],count:0,commentDrawer:!1,commentTextArea:""}},created:function(){this.fetchCommentsList()},methods:{fetchCommentsList:function(){this.$http.get(this.baseUrl+"x/comment/api/comments?concept="+this.concept+"&id="+this.id).then(function(e){this.list=e.data,this.count=this.list.length}.bind(this))},publishComment:function(){var e={msg:this.commentTextArea};e.msg&&(e.concept=this.concept,e.id=this.id,this.$http.post(this.baseUrl+"x/comment/api/comments?concept="+this.concept+"&id="+this.id,e).then(function(){this.commentTextArea="",this.fetchCommentsList()}.bind(this)))},updateComment:function(e){this.$http.put(this.baseUrl+"x/comment/api/comments/"+e.uuid,e).then(function(){this.commentTextArea="",this.fetchCommentsList()}.bind(this))},toDelay:function(e){let t=Me.date.getDateDiff(Date.now(),e,"days");return t>0?t+" days":(t=Me.date.getDateDiff(Date.now(),e,"hours"),t>0?t+" hours":(t=Me.date.getDateDiff(Date.now(),e,"minutes"),t>0?t+" min":"Now"))}}},he=window.Vue.toDisplayString,Ce=window.Vue.createTextVNode,E=window.Vue.resolveComponent,k=window.Vue.withCtx,de=window.Vue.openBlock,ke=window.Vue.createBlock,Ae=window.Vue.createCommentVNode,V=window.Vue.createVNode,jt=window.Vue.renderList,It=window.Vue.Fragment,ot=window.Vue.createElementBlock,nt=window.Vue.createElementVNode,zt=window.Vue.normalizeClass,Ht=["src"];function Rt(e,t,o,a,s,n){const i=E("q-badge"),r=E("q-btn"),l=E("big"),c=E("q-item-label"),p=E("q-input"),f=E("q-item-section"),u=E("q-item"),h=E("q-separator"),d=E("q-avatar"),m=E("q-icon"),w=E("q-popup-edit"),_=E("q-list"),S=E("q-drawer");return de(),ot("span",null,[V(r,{round:"",size:"lg",color:"primary",textColor:"white",icon:e.count>0?o.icon:o.iconNone,onClick:t[0]||(t[0]=g=>e.commentDrawer=!e.commentDrawer),class:"on-left"},{default:k(()=>[e.count>0?(de(),ke(i,{key:0,floating:"",small:"",color:"red",style:{right:"-.4em",top:"-.4em"}},{default:k(()=>[Ce(he(e.count),1)]),_:1})):Ae("",!0)]),_:1},8,["icon"]),V(S,{overlay:"",behavior:"mobile",width:600,modelValue:e.commentDrawer,"onUpdate:modelValue":t[2]||(t[2]=g=>e.commentDrawer=g),side:"right",style:{top:"58px"}},{default:k(()=>[V(_,null,{default:k(()=>[V(c,{header:""},{default:k(()=>[V(l,null,{default:k(()=>[Ce(he(e.$q.lang.vui.comments.title),1)]),_:1})]),_:1}),V(u,null,{default:k(()=>[V(f,null,{default:k(()=>[V(p,{class:"col",type:"textarea",autogrow:"",modelValue:e.commentTextArea,"onUpdate:modelValue":t[1]||(t[1]=g=>e.commentTextArea=g),label:e.$q.lang.vui.comments.inputLabel,"stack-label":""},null,8,["modelValue","label"])]),_:1}),V(f,{side:""},{default:k(()=>[V(r,{color:"primary",round:"",icon:"send",title:e.$q.lang.vui.comments.actionLabel,"aria-label":e.$q.lang.vui.comments.actionLabel,onClick:n.publishComment},null,8,["title","aria-label","onClick"])]),_:1})]),_:1}),V(h),(de(!0),ot(It,null,jt(e.list,g=>(de(),ke(u,{key:g.uuid,class:zt(["items-start",{"cursor-pointer":g.author==o.connectedAccount}])},{default:k(()=>[V(f,{avatar:""},{default:k(()=>[V(d,null,{default:k(()=>[nt("img",{src:o.baseUrl+"x/accounts/api/"+g.author+"/photo"},null,8,Ht)]),_:2},1024)]),_:2},1024),V(f,null,{default:k(()=>[V(c,null,{default:k(()=>[Ce(he(g.authorDisplayName),1)]),_:2},1024),nt("div",null,he(g.msg),1)]),_:2},1024),V(f,{side:""},{default:k(()=>[V(c,{stamp:""},{default:k(()=>[Ce(he(n.toDelay(new Date(g.creationDate))),1)]),_:2},1024),g.author==o.connectedAccount?(de(),ke(m,{key:0,name:"edit"})):Ae("",!0)]),_:2},1024),g.author==o.connectedAccount?(de(),ke(w,{key:0,buttons:!0,onSave:B=>n.updateComment(g),"label-cancel":e.$q.lang.vui.comments.cancel,"label-set":e.$q.lang.vui.comments.save},{default:k(()=>[V(p,{type:"textarea",autogrow:"",modelValue:g.msg,"onUpdate:modelValue":B=>g.msg=B,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["onSave","label-cancel","label-set"])):Ae("",!0)]),_:2},1032,["class"]))),128))]),_:1})]),_:1},8,["modelValue"])])}var Yt=C(At,[["render",Rt]]);const Qt={props:{activeSkills:{type:Array,required:!0}},data:function(){return{extensions:[]}},created:function(){var e=[{name:"vertigo-audit",label:"Audit",description:"Trace every single aspect of your app through exhaustive logging capabilities.",color:"#F7578C",icon:"fas fa-clipboard-list",enabled:!1},{name:"vertigo-dashboard",label:"Dashboard",description:"Monitor you system to make sure your app meets the customer requirements.",color:"#742774",icon:"fas fa-chart-line",enabled:!1},{name:"vertigo-geo",label:"Geo",description:"Enhance your data by enabling geographic functions and tools.",icon:"fas fa-globe",color:"#0E2947",enabled:!1},{name:"vertigo-ledger",label:"Ledger",description:"Use a blockchain to enforce secure transactions in your app !",icon:"fas fa-link",color:"#00AC5C",enabled:!1},{name:"vertigo-orchestra",label:"Orchestra",description:"Manage jobs and monitor their status with this powerfull control tower.",color:"#FC636B",icon:"fas fa-tasks",enabled:!1},{name:"vertigo-quarto",label:"Quarto",description:"Generate slick documents and reports using the Quarto template engine.",color:"#0747A6",icon:"fas fa-file-invoice",enabled:!1},{name:"vertigo-social",label:"Social",description:"Ensure real time communication and collaboration between your app users.",color:"#FF3366",icon:"far fa-comments",enabled:!1},{name:"vertigo-stella",label:"Stella",description:"Enable multi-node task dispatching for your app and assign specific tasks to each node.",color:"#0066FF",icon:"fas fa-network-wired",enabled:!1}];e.forEach(function(t){t.enabled=this.$props.activeSkills.indexOf(t.name)>-1}.bind(this)),this.extensions=e},methods:{getIconStyle:function(e){return"border: 3px solid "+e+"; background-color: "+e+"; color: white; padding: 5px; width: 70px; height: 70px;"}}},Gt=window.Vue.renderList,Jt=window.Vue.Fragment,je=window.Vue.openBlock,Ie=window.Vue.createElementBlock,ge=window.Vue.resolveComponent,Xt=window.Vue.normalizeStyle,ue=window.Vue.createVNode,qe=window.Vue.withCtx,at=window.Vue.toDisplayString,we=window.Vue.createElementVNode,Wt={class:"row q-col-gutter-md"},Kt={class:"row col items-center"},Zt={class:"q-subheading text-bold"},eo=we("div",{class:"col"},null,-1),to={class:"row col q-body-2 text-justify"};function oo(e,t,o,a,s,n){const i=ge("q-icon"),r=ge("q-item-section"),l=ge("q-toggle"),c=ge("q-item"),p=ge("q-card");return je(),Ie("div",Wt,[(je(!0),Ie(Jt,null,Gt(e.extensions,f=>(je(),Ie("div",{class:"col-xs-12 col-lg-6 col-xl-4",key:f.name},[ue(p,null,{default:qe(()=>[ue(c,{class:"bg-white",style:{height:"100px"}},{default:qe(()=>[ue(r,{avatar:""},{default:qe(()=>[ue(i,{name:f.icon,size:"40px",style:Xt(n.getIconStyle(f.color))},null,8,["name","style"])]),_:2},1024),ue(r,null,{default:qe(()=>[we("div",Kt,[we("div",Zt,at(f.label),1),eo,we("div",null,[ue(l,{disable:"",readonly:"",color:"positive",modelValue:f.enabled,"onUpdate:modelValue":u=>f.enabled=u},null,8,["modelValue","onUpdate:modelValue"])])]),we("div",to,at(f.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))])}var no=C(Qt,[["render",oo]]);const ao={props:{facets:Array,selectedFacets:Object,contextKey:String,maxValues:{type:Number,default:5}},emits:["toogle-facet"],computed:{},data:function(){return{expandedFacets:[]}},methods:{facetByCode(e){return this.facets.filter(function(t){return t.code===e})[0]},facetValueByCode(e,t){return this.facetByCode(e).values.filter(function(o){return o.code===t})[0]},facetLabelByCode(e){return this.facetByCode(e).label},facetMultipleByCode(e){return this.facetByCode(e).multiple},facetValueLabelByCode(e,t){var o=this.facetValueByCode(e,t);return o?o.label:t},isFacetValueSelected(e,t){return this.selectedFacets[e].includes(t)},isFacetSelected(e){return this.selectedFacets[e]?this.selectedFacets[e].length>0:!1},isAnyFacetValueSelected(){return Object.keys(this.selectedFacets).some(function(e){return!this.facetMultipleByCode(e)}.bind(this))},expandFacet(e){this.isFacetExpanded(e)||this.$data.expandedFacets.push(e)},reduceFacet(e){this.isFacetExpanded(e)&&this.$data.expandedFacets.splice(this.$data.expandedFacets.indexOf(e),1)},isFacetExpanded(e){return this.$data.expandedFacets.includes(e)},selectedInvisibleFacets(e){return this.selectedFacets[e].filter(t=>!this.facetValueByCode(e,t)).map(t=>{var o={};return o.code=t,o.label=t,o.count=0,o})},visibleFacets(e,t){return this.isFacetExpanded(e)?t:t.slice(0,this.maxValues)}}},_e=window.Vue.renderList,pe=window.Vue.Fragment,q=window.Vue.openBlock,z=window.Vue.createElementBlock,H=window.Vue.toDisplayString,X=window.Vue.createTextVNode,W=window.Vue.resolveComponent,F=window.Vue.withCtx,K=window.Vue.createBlock,ae=window.Vue.createCommentVNode,Z=window.Vue.createVNode,so={class:"facets"},io={key:0,class:"selectedFacets q-pb-md"};function ro(e,t,o,a,s,n){const i=W("q-chip"),r=W("big"),l=W("q-item-label"),c=W("q-checkbox"),p=W("q-item-section"),f=W("q-item"),u=W("q-btn"),h=W("q-list");return q(),z("div",so,[n.isAnyFacetValueSelected()?(q(),z("div",io,[(q(!0),z(pe,null,_e(o.selectedFacets,(d,m)=>(q(),z("div",{key:m},[n.facetMultipleByCode(m)?ae("",!0):(q(!0),z(pe,{key:0},_e(d,w=>(q(),K(i,{clickable:"",class:"q-mb-sm",key:w.code,onClick:_=>e.$emit("toogle-facet",m,w,o.contextKey),"icon-right":"cancel"},{default:F(()=>[X(H(n.facetLabelByCode(m))+": "+H(n.facetValueLabelByCode(m,w)),1)]),_:2},1032,["onClick"]))),128))]))),128))])):ae("",!0),(q(!0),z(pe,null,_e(o.facets,d=>(q(),K(h,{key:d.code,class:"facetValues q-py-none",dense:""},{default:F(()=>[d.multiple||!n.isFacetSelected(d.code)?(q(),z(pe,{key:0},[Z(l,{header:""},{default:F(()=>[Z(r,null,{default:F(()=>[X(H(d.label),1)]),_:2},1024)]),_:2},1024),(q(!0),z(pe,null,_e(n.selectedInvisibleFacets(d.code),m=>(q(),K(f,{key:m.code,class:"facetValue q-ml-md",clickable:"",onClick:w=>e.$emit("toogle-facet",d.code,m.code,o.contextKey)},{default:F(()=>[d.multiple?(q(),K(p,{key:0,side:""},{default:F(()=>[Z(c,{dense:"",modelValue:!0,"onUpdate:modelValue":w=>e.$emit("toogle-facet",d.code,m.code,o.contextKey)},null,8,["onUpdate:modelValue"])]),_:2},1024)):ae("",!0),Z(p,null,{default:F(()=>[X(H(m.label),1)]),_:2},1024),Z(p,{side:""},{default:F(()=>[X(H(m.count),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(q(!0),z(pe,null,_e(n.visibleFacets(d.code,d.values),m=>(q(),K(f,{key:m.code,class:"facetValue q-ml-md",clickable:"",onClick:w=>e.$emit("toogle-facet",d.code,m.code,o.contextKey)},{default:F(()=>[d.multiple?(q(),K(p,{key:0,side:""},{default:F(()=>[Z(c,{dense:"",modelValue:n.isFacetValueSelected(d.code,m.code),"onUpdate:modelValue":w=>e.$emit("toogle-facet",d.code,m.code,o.contextKey)},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):ae("",!0),Z(p,null,{default:F(()=>[X(H(m.label),1)]),_:2},1024),Z(p,{side:""},{default:F(()=>[X(H(m.count),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),d.values.length>o.maxValues&&!n.isFacetExpanded(d.code)?(q(),K(u,{key:0,flat:"",onClick:m=>n.expandFacet(d.code)},{default:F(()=>[X(H(e.$q.lang.vui.facets.showAll),1)]),_:2},1032,["onClick"])):ae("",!0),d.values.length>o.maxValues&&n.isFacetExpanded(d.code)?(q(),K(u,{key:1,flat:"",onClick:m=>n.reduceFacet(d.code)},{default:F(()=>[X(H(e.$q.lang.vui.facets.showLess),1)]),_:2},1032,["onClick"])):ae("",!0)],64)):ae("",!0)]),_:2},1024))),128))])}var lo=C(ao,[["render",ro]]);const co={props:{modelValue:{type:Object}},emits:["update:modelValue"],data:function(){return{inputObject:this.$props.modelValue?this.$props.modelValue:{}}},watch:{modelValue:function(e){this.$data.inputObject=e||{},this.updateJson()}},beforeMount(){this.updateJson()},methods:{updateJson(){var e;this.$props.modelValue&&(e=JSON.stringify({lon:this.$data.inputObject.lon,lat:this.$data.inputObject.lat}),this.$props.modelValue._v_inputValue=e),this.$emit("update:modelValue",this.$data.inputObject)}}},uo=window.Vue.resolveComponent,st=window.Vue.createVNode,po=window.Vue.openBlock,mo=window.Vue.createElementBlock,fo={class:"row"};function ho(e,t,o,a,s,n){const i=uo("q-input");return po(),mo("div",fo,[st(i,{label:"Longitude","stack-label":"",modelValue:e.inputObject.lon,"onUpdate:modelValue":[t[0]||(t[0]=r=>e.inputObject.lon=r),n.updateJson],modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"]),st(i,{label:"Latitude","stack-label":"",modelValue:e.inputObject.lat,"onUpdate:modelValue":[t[1]||(t[1]=r=>e.inputObject.lat=r),n.updateJson],modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])])}var go=C(co,[["render",ho]]);const wo={props:{baseUrl:{type:String,default:"/"}},data:function(){return{text:"",handles:[]}},methods:{searchHandles:function(e){e&&this.$http.post(this.baseUrl+"api/vertigo/handle/_search",{prefix:e}).then(function(t){this.$data.handles=t.data}.bind(this))}}},ve=window.Vue.resolveComponent,Se=window.Vue.createVNode,De=window.Vue.withCtx,_o=window.Vue.renderList,vo=window.Vue.Fragment,ze=window.Vue.openBlock,it=window.Vue.createElementBlock,$o=window.Vue.toDisplayString,bo=window.Vue.createTextVNode,yo=window.Vue.resolveDirective,Vo=window.Vue.createBlock,Co=window.Vue.withDirectives;function ko(e,t,o,a,s,n){const i=ve("q-icon"),r=ve("q-input"),l=ve("q-item-section"),c=ve("q-item"),p=ve("q-list"),f=yo("ripple");return ze(),it("div",null,[Se(r,{placeholder:e.$q.lang.vui.handles.placeholder,modelValue:e.text,"onUpdate:modelValue":t[0]||(t[0]=u=>e.text=u),debounce:300,onInput:n.searchHandles,autofocus:"",outlined:"","bg-color":"white",dense:""},{prepend:De(()=>[Se(i,{name:"search"})]),_:1},8,["placeholder","modelValue","onInput"]),Se(p,{bordered:"",dense:"",separator:""},{default:De(()=>[(ze(!0),it(vo,null,_o(e.handles,u=>Co((ze(),Vo(c,{clickable:"",onClick:h=>e.VUi.methods.goTo(o.baseUrl+"hw/"+u.code),key:u.code},{default:De(()=>[Se(l,null,{default:De(()=>[bo($o(u.code),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[f]])),128))]),_:1})])}var qo=C(wo,[["render",ko]]);const So={props:{modelValue:{type:String,required:!0},readonly:{type:Boolean,required:!0},cols:{type:Number,default:2}},emits:["update:modelValue"],data:function(){return{jsonAsObject:JSON.parse(this.$props.modelValue)}},watch:{modelValue:function(e){this.$data.jsonAsObject=JSON.parse(e)}},methods:{updateJson(){this.$emit("update:modelValue",JSON.stringify(this.$data.jsonAsObject))}}},Do=window.Vue.renderList,xo=window.Vue.Fragment,$e=window.Vue.openBlock,He=window.Vue.createElementBlock,rt=window.Vue.resolveComponent,lt=window.Vue.createBlock;window.Vue.createCommentVNode;const Fo=window.Vue.toDisplayString,Eo=window.Vue.createElementVNode,To=window.Vue.withCtx,Bo=window.Vue.normalizeClass,Lo={class:"row"};function Uo(e,t,o,a,s,n){const i=rt("q-input"),r=rt("q-field");return $e(),He("div",Lo,[($e(!0),He(xo,null,Do(e.jsonAsObject,(l,c)=>($e(),He("div",{key:c,class:Bo("col-"+12/o.cols)},[o.readonly?($e(),lt(r,{key:1,label:c,orientation:"vertical","stack-label":"",borderless:"",readonly:""},{default:To(()=>[Eo("span",null,Fo(l),1)]),_:2},1032,["label"])):($e(),lt(i,{key:0,label:c,orientation:"vertical","stack-label":"",modelValue:e.jsonAsObject[c],"onUpdate:modelValue":[p=>e.jsonAsObject[c]=p,n.updateJson]},null,8,["label","modelValue","onUpdate:modelValue"]))],2))),128))])}var Oo=C(So,[["render",Uo]]);const xe=window.Quasar,Po={props:{icon:{type:String,default:"notifications"},iconNone:{type:String,default:"notifications_none"},typeIconMap:{type:Object,default:function(){return{}}},baseUrl:{type:String,default:"/api/",required:!0}},data:function(){return{firstCall:!0,list:[],hasNew:!1,wasError:!1,count:0,timer:""}},created:function(){this.fetchNotificationsList(),this.timer=setInterval(this.fetchNotificationsList,5e3)},methods:{fetchNotificationsList:function(){this.$http.get(this.baseUrl+"x/notifications/api/messages",{timeout:5*1e3}).then(function(e){this.updateNotificationsData(e.data),this.wasError&&(clearInterval(this.timer),this.timer=setInterval(this.fetchNotificationsList,5e3)),this.wasError=!1}.bind(this)).catch(function(){this.wasError||(clearInterval(this.timer),this.timer=setInterval(this.fetchNotificationsList,6e4)),this.wasError=!0}.bind(this))},updateNotificationsData:function(e){const t=e.sort(function(n,i){return i.creationDate-n.creationDate});var o=[],a=this.list[0];if(!a)o=t;else for(var s=0;s<t.length;s++)if(t[s].uuid!=a.uuid){if(t[s].creationDate<a.creationDate)break;o.push(t[s])}this.list=t,this.count=t.length,this.hasNew=o.length>0,this.firstCall||o.forEach(function(n){this.$q.notify({type:"info",icon:this.toIcon(n.type),message:n.title,detail:n.content,timeout:3e3,position:"bottom-right"})}.bind(this)),this.firstCall=!1},cancelAutoUpdate:function(){clearInterval(this.timer)},toIcon:function(e){var t=this.typeIconMap[e];return t||"mail"},toDelay:function(e){let t=xe.date.getDateDiff(Date.now(),e,"days");return t>0?t+" "+this.$q.lang.vui.notifications.days:(t=xe.date.getDateDiff(Date.now(),e,"hours"),t>0?t+" "+this.$q.lang.vui.notifications.hours:(t=xe.date.getDateDiff(Date.now(),e,"minutes"),t>0?t+" "+this.$q.lang.vui.notifications.minutes:(t=xe.date.getDateDiff(Date.now(),e,"seconds"),t+" "+this.$q.lang.vui.notifications.seconds)))}},beforeDestroy:function(){clearInterval(this.timer)}},Fe=window.Vue.toDisplayString,Ee=window.Vue.createTextVNode,ee=window.Vue.resolveComponent,P=window.Vue.withCtx,Te=window.Vue.openBlock,Re=window.Vue.createBlock,No=window.Vue.createCommentVNode,Mo=window.Vue.renderList,Ao=window.Vue.Fragment,jo=window.Vue.createElementBlock,R=window.Vue.createVNode;function Io(e,t,o,a,s,n){const i=ee("q-badge"),r=ee("q-icon"),l=ee("q-item-section"),c=ee("q-item-label"),p=ee("q-item"),f=ee("q-list"),u=ee("q-menu"),h=ee("q-btn");return Te(),Re(h,{round:"",dense:"",color:e.hasNew?"primary":"white",textColor:e.hasNew?"white":"primary",icon:e.count>0?o.icon:o.iconNone,class:"on-left"},{default:P(()=>[e.count>0?(Te(),Re(i,{key:0,color:"red","text-color":"white",floating:""},{default:P(()=>[Ee(Fe(e.count),1)]),_:1})):No("",!0),R(u,{class:"notifications"},{default:P(()=>[R(f,{style:{width:"300px"}},{default:P(()=>[(Te(!0),jo(Ao,null,Mo(e.list,d=>(Te(),Re(p,{key:d.uuid,tag:"a",href:d.targetUrl},{default:P(()=>[R(l,{avatar:""},{default:P(()=>[R(r,{name:n.toIcon(d.type),size:"2rem"},null,8,["name"])]),_:2},1024),R(l,null,{default:P(()=>[R(c,null,{default:P(()=>[Ee(Fe(d.title),1)]),_:2},1024),R(c,{caption:"",lines:"3"},{default:P(()=>[Ee(Fe(d.content),1)]),_:2},1024)]),_:2},1024),R(l,{side:"",top:""},{default:P(()=>[R(c,{caption:""},{default:P(()=>[Ee(Fe(n.toDelay(new Date(d.creationDate))),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["href"]))),128))]),_:1})]),_:1})]),_:1},8,["color","textColor","icon"])}var zo=C(Po,[["render",Io]]);const ct=window.Quasar,N=window.ol,Ho={props:{id:{type:String,required:!0},initialZoomLevel:{type:Number},initialCenter:{type:Object}},emits:["moveend","click"],methods:{onMapLoad:function(e){var t=this;function o(){t.olMap?(e(t.olMap),t.postInit()):setTimeout(o,50)}o()},postInit(){this.$props.initialZoomLevel&&this.olMap.getView().setZoom(this.$props.initialZoomLevel)}},mounted:function(){var e=new N.View,t=new N.layer.Tile({preload:4,source:new N.source.OSM});this.olMap=new N.Map({interactions:N.interaction.defaults({onFocusOnly:!0}),target:this.$props.id,layers:[t],loadTilesWhileAnimating:!0,view:e}),this.$props.initialCenter&&this.olMap.getView().setCenter(N.proj.fromLonLat([this.$props.initialCenter.lon,this.$props.initialCenter.lat])),this.olMap.on("moveend",function(o){var a=o.map.getView().calculateExtent(),s=N.proj.transformExtent(a,"EPSG:3857","EPSG:4326"),n=N.extent.getTopLeft(s),i=N.extent.getBottomRight(s);ct.debounce(this.$emit("moveend",n,i),300)}.bind(this)),setTimeout(function(){this.olMap.on("click",function(o){o.stopPropagation(),ct.debounce(this.$emit("click",N.proj.transform(o.coordinate,"EPSG:3857","EPSG:4326")),300)}.bind(this))}.bind(this),300)}},Ro=window.Vue.normalizeProps,Yo=window.Vue.guardReactiveProps,Qo=window.Vue.renderSlot,Go=window.Vue.openBlock,Jo=window.Vue.createElementBlock,Xo=["id"];function Wo(e,t,o,a,s,n){return Go(),Jo("div",{id:o.id},[Qo(e.$slots,"default",Ro(Yo(e.$attrs)))],8,Xo)}var Ko=C(Ho,[["render",Wo]]);const Be=window.Quasar,v=window.ol,Zo={props:{id:{type:String,required:!0},list:{type:Array},cluster:{type:Array},object:{type:Object},baseUrl:{type:String},field:{type:String,required:!0},nameField:{type:String},markerColor:{type:String,default:"#000000"},markerFont:{type:String,default:"Material Icons"},markerIcon:{type:String,default:"place"},markerSize:{type:Number,default:30},clusterCircleSize:{type:Number,default:20},clusterColor:{type:String,default:"#fff"},clusterCircleBorderColor:{type:String,default:"#000000"},clusterTextColor:{type:String,default:"#000000"},clusterTextSize:{type:Number,default:12},clusterTextFont:{type:String,default:"sans-serif"}},emits:["moveend","click"],data:function(){return{popupDisplayed:!1,objectDisplayed:{},items:[],clusters:[],olMap:{},vectorSource:{},base32:"0123456789bcdefghjkmnpqrstuvwxyz"}},watch:{list:function(e){this.$data.items=e,this.$data.vectorSource.clear(),this.$data.vectorSource.addFeatures(this.features)},cluster:function(e){this.$data.items=[],this.$data.clusters=[];for(var t=0;t<e.length;t++)e[t].totalCount==1?this.$data.items=this.$data.items.concat(e[t].list):this.$data.clusters.push({geoHash:e[t].code,geoLocation:this.decode(e[t].code),totalCount:e[t].totalCount});this.$data.vectorSource.clear(),this.$data.vectorSource.addFeatures(this.features)},"object.geoLocation":function(){this.$data.vectorSource.clear(),this.$data.vectorSource.addFeatures(this.features)}},computed:{features:function(){var e=this.$props.field,t=this.$data.items.filter(function(a){return a[e]!=null}).map(function(a){var s;if(typeof a[e]=="string"||a[e]instanceof String?s=JSON.parse(a[e]):s=a[e],s!=null){var n=new v.Feature({geometry:new v.geom.Point(v.proj.fromLonLat([s.lon,s.lat]))});return this.$props.nameField&&(n.set("name",a[this.$props.nameField]),n.set("innerObject",a),n.set("totalCount",a.totalCount)),n}return null}.bind(this)),o=this.$data.clusters.filter(function(a){return a[e]!=null}).map(function(a){var s;if(typeof a[e]=="string"||a[e]instanceof String?s=JSON.parse(a[e]):s=a[e],s!=null){var n=new v.Feature({geometry:new v.geom.Point(v.proj.fromLonLat([s.lon,s.lat]))});return this.$props.nameField&&(n.set("name",a[this.$props.nameField]),n.set("innerObject",a),n.set("totalCount",a.totalCount)),n}return null}.bind(this));return t.concat(o)}},methods:{fetchList:function(e,t){this.$http.get(this.baseUrl+'_geoSearch?topLeft="'+e.lat+","+e.lon+'"&bottomRight="'+t.lat+","+t.lon+'"',{timeout:5*1e3}).then(function(o){this.$data.items=o.data,this.$data.vectorSource.clear(),this.$data.vectorSource.addFeatures(this.features)}.bind(this))},decode:function(e){const t=this.bounds(e),o=t.sw.lat,a=t.sw.lon,s=t.ne.lat,n=t.ne.lon;let i=(o+s)/2,r=(a+n)/2;return i=i.toFixed(Math.floor(2-Math.log(s-o)/Math.LN10)),r=r.toFixed(Math.floor(2-Math.log(n-a)/Math.LN10)),{lat:Number(i),lon:Number(r)}},bounds:function(e){if(e.length==0)throw new Error("Invalid geohash");e=e.toLowerCase();let t=!0,o=-90,a=90,s=-180,n=180;for(let r=0;r<e.length;r++){const l=e.charAt(r),c=this.$data.base32.indexOf(l);if(c==-1)throw new Error("Invalid geohash");for(let p=4;p>=0;p--){const f=c>>p&1;if(t){const u=(s+n)/2;f==1?s=u:n=u}else{const u=(o+a)/2;f==1?o=u:a=u}t=!t}}return{sw:{lat:o,lon:s},ne:{lat:a,lon:n}}}},mounted:function(){this.$parent.onMapLoad(function(e){if(this.$data.olMap=e,this.$data.items=[],this.$data.clusters=[],this.$props.list)this.$data.items=this.$props.list;else if(this.$props.cluster)for(var t=0;t<this.$props.cluster.length;t++)this.$props.cluster[t].totalCount==1?this.$data.items=this.$data.items.concat(this.$props.cluster[t].list):this.$data.clusters.push({geoHash:this.$props.cluster[t].code,geoLocation:this.decode(this.$props.cluster[t].code),totalCount:this.$props.cluster[t].totalCount});else this.$props.object&&(this.$data.items=[this.$props.object]);this.$data.vectorSource=new v.source.Vector({features:this.features});var o=new v.source.Cluster({source:this.$data.vectorSource,distance:2*this.$props.clusterCircleSize}),a=new v.layer.Vector({source:o}),s=new v.style.Style({text:new v.style.Text({font:this.$props.markerSize+"px "+this.$props.markerFont,text:this.$props.markerIcon,fill:new v.style.Fill({color:this.$props.markerColor}),offsetY:0})}),n={};if(a.setStyle(function(r){for(var l=0,c=r.get("features"),p=0;p<c.length;p++){var f=c[p].get("totalCount");l+=f||1}if(!l||l==1)return s;var u=n[l];return u||(u=new v.style.Style({image:new v.style.Circle({radius:this.$props.clusterCircleSize,stroke:new v.style.Stroke({color:this.$props.clusterCircleBorderColor}),fill:new v.style.Fill({color:this.$props.clusterColor})}),text:new v.style.Text({text:l.toString(),font:this.$props.clusterTextSize+"px "+this.$props.clusterTextFont,fill:new v.style.Fill({color:this.$props.clusterTextColor})})}),n[l]=u),u}.bind(this)),this.olMap.addLayer(a),this.features.length>0&&this.olMap.getView().fit(a.getSource().getSource().getExtent(),this.olMap.getSize()),this.olMap.on("moveend",function(r){var l=r.map.getView().calculateExtent(),c=v.proj.transformExtent(l,"EPSG:3857","EPSG:4326"),p=v.extent.getTopLeft(c),f=v.extent.getBottomRight(c);this.baseUrl&&Be.debounce(this.fetchList({lat:p[0],lon:p[1]},{lat:f[0],lon:f[1]}),300),Be.debounce(this.$emit("moveend",p,f),300)}.bind(this)),this.$props.nameField){var i=new v.Overlay({element:this.$el.querySelector("#"+this.$props.id+"Popup"),positioning:"bottom-center",stopEvent:!1,offset:[0,-20]});this.olMap.addOverlay(i),this.olMap.on("click",function(r){var l=this.olMap.forEachFeatureAtPixel(r.pixel,function(p){return p});if(l&&l.get("features").length==1){var c=l.getGeometry().getCoordinates();i.setPosition(c),this.$data.popupDisplayed=!0,this.$data.objectDisplayed=l.get("features")[0].get("innerObject"),r.stopPropagation(),Be.debounce(this.$emit("click",v.proj.transform(c,"EPSG:3857","EPSG:4326")),300)}else this.$data.popupDisplayed=!1}.bind(this)),this.olMap.on("pointermove",function(r){if(r.dragging){this.$data.popupDisplayed=!1;return}var l=this.olMap.getEventPixel(r.originalEvent),c=this.olMap.hasFeatureAtPixel(l);this.olMap.getTargetElement().style.cursor=c?"pointer":""}.bind(this))}else this.olMap.on("click",function(r){var l=this.olMap.forEachFeatureAtPixel(r.pixel,function(p){return p});if(l&&l.get("features").length==1){var c=l.getGeometry().getCoordinates();r.stopPropagation(),Be.debounce(this.$emit("click",v.proj.transform(c,"EPSG:3857","EPSG:4326")),300)}}.bind(this))}.bind(this))}},en=window.Vue.renderSlot,tn=window.Vue.toDisplayString,dt=window.Vue.createElementVNode,on=window.Vue.resolveComponent,nn=window.Vue.withCtx,ut=window.Vue.openBlock,an=window.Vue.createBlock,sn=window.Vue.createCommentVNode,rn=window.Vue.createElementBlock,ln=["id"],cn=["id"],dn={class:"text-subtitle2"};function un(e,t,o,a,s,n){const i=on("q-card");return ut(),rn("div",{id:o.id},[dt("div",{id:o.id+"Popup"},[e.popupDisplayed?(ut(),an(i,{key:0,class:"q-px-md"},{default:nn(()=>[en(e.$slots,"card",{objectDisplayed:e.objectDisplayed},()=>[dt("div",dn,tn(e.objectDisplayed[o.nameField]),1)])]),_:3})):sn("",!0)],8,cn)],8,ln)}var pn=C(Zo,[["render",un]]);const mn=window.Quasar,fn={props:{modelValue:{type:String,required:!0},list:{type:Array,required:!0},keyField:{type:String,required:!0},labelField:{type:String,required:!0},parentKeyField:{type:String,required:!0},subTreeKey:{type:String,required:!1}},emits:["update:modelValue"],data:function(){return{selectedNode:this.$props.modelValue,expandedNodes:[this.$props.modelValue]}},watch:{modelValue:function(e){this.$data.selectedNode=e}},methods:{handleSelected:function(e){this.$emit("update:modelValue",this.$data.selectedNode),e&&this.$refs.menu.hide()},handleExpanded:function(){mn.debounce(this.$refs.menu.updatePosition,500)()},getSelectedLabel:function(){return this.$data.selectedNode?this.$props.list.find(function(t){return t[this.$props.keyField]===this.$data.selectedNode}.bind(this))[this.$props.labelField]:null},convertListToTree:function(e,t){var o={},a,s=[],n;for(n=0;n<e.length;n+=1)o[e[n][this.$props.keyField]]=n,e[n].children=[];for(n=0;n<e.length;n+=1)a=e[n],a[this.$props.parentKeyField]?e[o[a[this.$props.parentKeyField]]].children.push(a):s.push(a);return t?[e[o[t]]]:s}}},Le=window.Vue.resolveComponent,Ye=window.Vue.createVNode,hn=window.Vue.toDisplayString,gn=window.Vue.createElementVNode,Ue=window.Vue.withCtx,wn=window.Vue.normalizeProps,_n=window.Vue.guardReactiveProps,vn=window.Vue.openBlock,$n=window.Vue.createBlock,bn={class:"self-center full-width no-outline",tabindex:"0"};function yn(e,t,o,a,s,n){const i=Le("q-icon"),r=Le("q-tree"),l=Le("q-menu"),c=Le("q-field");return vn(),$n(c,wn(_n(e.$attrs)),{append:Ue(()=>[Ye(i,{name:"arrow_drop_down"})]),control:Ue(()=>[gn("div",bn,hn(n.getSelectedLabel()),1)]),default:Ue(()=>[Ye(l,{breakpoint:600,fit:"",ref:"menu"},{default:Ue(()=>[Ye(r,{nodes:n.convertListToTree(e.$props.list,e.$props.subTreeKey),"node-key":e.$props.keyField,"label-key":e.$props.labelField,expanded:e.expandedNodes,"onUpdate:expanded":[t[0]||(t[0]=p=>e.expandedNodes=p),n.handleExpanded],selected:e.selectedNode,"onUpdate:selected":[t[1]||(t[1]=p=>e.selectedNode=p),n.handleSelected]},null,8,["nodes","node-key","label-key","expanded","onUpdate:expanded","selected","onUpdate:selected"])]),_:1},512)]),_:1},16)}var Vn=C(fn,[["render",yn]]);const Cn=window.Quasar.format,{humanStorageSize:kn}=Cn,qn={props:{readonly:Boolean,label:String,simple:{type:Boolean,default:!1},fileInfoUris:Array,fieldName:String,url:String,downloadUrl:{type:String,default:e=>e.baseUrl+"/download"},multiple:{type:Boolean,default:!0}},emits:["update:file-info-uris","download-file"],computed:{},mounted(){this.changeIcon();var e=new URLSearchParams;this.fileInfoUris.forEach(t=>{e.append(this.fieldName,t)}),this.$http.get(this.url+"/fileInfos",{params:e,credentials:!1}).then(function(t){var o=t.data;this.files=o.map(a=>a)}.bind(this)).catch(function(t){t.response?this.$q.notify(t.response.status+":"+t.response.statusText+" Can't load file "+e):this.$q.notify(t+" Can't load file "+e)}.bind(this))},data:function(){return{files:[]}},methods:{uploadedFiles(e){var t=[...this.fileInfoUris];e.files.forEach(function(o){this.files.push(o),o.fileUri=o.xhr.response,t.push(o.fileUri),this.$refs.quasarUploader.removeFile(o),this.$emit("update:file-info-uris",t)}.bind(this))},start(e,t,o){this.$refs.quasarUploader},removeRemoteFile(e){var t=this.files.indexOf(e),o=[...this.fileInfoUris],a={};a[this.fieldName]=e.fileUri,this.$http.delete(this.url,{params:a,credentials:!1}).then(function(){this.multiple?(this.files.splice(t,1),o.splice(t,1)):(this.files.splice(0),o.splice(0)),this.$emit("update:file-info-uris",o)}.bind(this)).catch(function(s){this.$q.notify(s.response.status+":"+s.response.statusText+" Can't remove temporary file")}.bind(this))},globalCanAddFiles(e){return this.multiple?!this.$props.readonly:!this.$props.readonly&&e.filter(t=>t.__status!="uploaded").length+this.fileInfoUris.length<1},changeIcon(){this.$q.iconSet.uploader.removeUploaded="delete_sweep",this.$q.iconSet.uploader.done="delete"},addFiles(e){var t=this.$refs.quasarUploader;this.globalCanAddFiles(t.files)&&this.$refs.quasarUploader.addFiles(e)},getGlobalSize(e){var t=e.filter(a=>a.__status!="uploaded").reduce((a,s)=>a+s.size,0),o=this.files.reduce((a,s)=>a+s.size,0);return kn(t+o)}}},M=window.Vue.toDisplayString,Oe=window.Vue.createTextVNode,te=window.Vue.resolveComponent,T=window.Vue.withCtx,A=window.Vue.createVNode,$=window.Vue.openBlock,O=window.Vue.createBlock,D=window.Vue.createCommentVNode,Y=window.Vue.createElementBlock,j=window.Vue.createElementVNode,pt=window.Vue.renderList,Qe=window.Vue.Fragment,Sn=window.Vue.normalizeClass,Dn=window.Vue.mergeProps,xn=window.Vue.createSlots,Fn={class:"row"},En={class:"col column justify-center"},Tn={class:"q-uploader__file-header row flex-center no-wrap"},Bn={class:"q-uploader__file-header-content col"},Ln={class:"q-uploader__title"},Un={class:"q-uploader__file-header row flex-center no-wrap"},On={class:"q-uploader__file-header-content col"},Pn={class:"q-uploader__title"},Nn={key:0,class:"q-field__after q-field__marginal row no-wrap items-center"};function Mn(e,t,o,a,s,n){const i=te("q-tooltip"),r=te("q-btn"),l=te("q-spinner"),c=te("q-uploader-add-trigger"),p=te("q-icon"),f=te("q-circular-progress"),u=te("q-field"),h=te("q-uploader");return $(),O(h,Dn({url:e.$props.url,"auto-upload":"","field-name":e.$props.fieldName,multiple:e.$props.multiple,"max-files":e.$props.multiple?void 0:1,headers:[{name:"Accept",value:"application/json"}],onUploaded:n.uploadedFiles,readonly:e.$props.readonly||!n.globalCanAddFiles([])},e.$attrs,{ref:"quasarUploader"}),xn({list:T(d=>[j("div",Fn,[A(u,{"label-width":3,label:e.$props.simple?e.$props.label:void 0,class:"col",orientation:"vertical","stack-label":"",borderless:""},{control:T(()=>[j("div",En,[e.$props.readonly?D("",!0):($(!0),Y(Qe,{key:0},pt(d.files,m=>($(),Y(Qe,{key:m.name},[m.__status!=="uploaded"?($(),Y("div",{key:0,class:Sn(["q-uploader__file relative-position",{"q-uploader__file--failed":m.__status==="failed","q-uploader__file--uploaded":m.__status==="uploaded"}])},[j("div",Tn,[m.__status==="failed"?($(),O(p,{key:0,class:"q-uploader__file-status",name:e.$q.iconSet.type.negative,color:"negative"},null,8,["name"])):D("",!0),A(p,{class:"q-uploader__file-status",name:m.type.indexOf("video/")===0?"movie":m.type.indexOf("image/")===0?"photo":m.type.indexOf("audio/")===0?"audiotrack":"insert_drive_file"},null,8,["name"]),j("div",Bn,[j("div",Ln,M(m.name),1)]),m.__status==="uploading"?($(),O(f,{key:1,value:m.__progress,min:0,max:1,indeterminate:m.__progress===0},null,8,["value","indeterminate"])):D("",!0),m.__status==="failed"?($(),O(r,{key:2,round:"",dense:"",flat:"",icon:e.$q.iconSet.uploader.clear,onClick:w=>d.removeFile(m)},null,8,["icon","onClick"])):D("",!0)])],2)):D("",!0)],64))),128)),($(!0),Y(Qe,null,pt(e.files,m=>($(),Y("div",{key:m.name,class:"q-uploader__file relative-position q-uploader__file--uploaded"},[j("div",Un,[A(p,{class:"q-uploader__file-status",name:m.type.indexOf("video/")===0?"movie":m.type.indexOf("image/")===0?"photo":m.type.indexOf("audio/")===0?"audiotrack":"insert_drive_file"},null,8,["name"]),j("div",On,[j("div",Pn,M(m.name),1)]),e.$props.readonly?D("",!0):($(),O(r,{key:0,round:"",dense:"",flat:"",icon:"delete",onClick:w=>n.removeRemoteFile(m)},null,8,["onClick"])),A(r,{round:"",dense:"",flat:"",icon:"file_download",onClick:w=>e.$emit("download-file",m.fileUri)},null,8,["onClick"])])]))),128))])]),_:2},1032,["label"]),e.$props.simple&&!e.$props.readonly?($(),Y("div",Nn,[d.isUploading?($(),O(l,{key:0,class:"q-uploader__spinner"})):D("",!0),n.globalCanAddFiles(d.files)?($(),O(r,{key:1,type:"a",icon:e.$q.iconSet.uploader.add,flat:"",dense:""},{default:T(()=>[A(c)]),_:1},8,["icon"])):D("",!0),d.isUploading?($(),O(r,{key:2,type:"a",icon:e.$q.iconSet.uploader.clear,flat:"",dense:"",onClick:d.abort},{default:T(()=>[A(i,null,{default:T(()=>[Oe(M(e.$q.lang.vui.uploader.clear),1)]),_:1})]),_:2},1032,["icon","onClick"])):D("",!0)])):D("",!0)])]),_:2},[e.$props.simple?{name:"header",fn:T(()=>[])}:{name:"header",fn:T(d=>[j("div",{class:"q-uploader__header-content flex flex-center no-wrap q-gutter-xs"},[d.queuedFiles.length>0&&!d.readonly?($(),O(r,{key:0,type:"a",icon:e.$q.iconSet.uploader.clear_all,flat:"",dense:"",onClick:d.removeQueuedFiles},{default:T(()=>[A(i,null,{default:T(()=>[Oe(M(e.$q.lang.vui.uploader.clear_all),1)]),_:1})]),_:2},1032,["icon","onClick"])):D("",!0),j("div",{class:"col column justify-center"},[e.$props.label!==void 0?($(),Y("div",{key:0,class:"q-uploader__title"},M(e.$props.label),1)):D("",!0),d.isUploading?($(),Y("div",{key:1,class:"q-uploader__subtitle"},M(n.getGlobalSize(d.files))+" / "+M(d.uploadProgressLabel),1)):($(),Y("div",{key:2,class:"q-uploader__subtitle"},M(n.getGlobalSize(d.files)),1))]),d.isUploading?($(),O(l,{key:1,class:"q-uploader__spinner"})):D("",!0),d.isUploading&&!d.readonly?($(),O(r,{key:2,type:"a",icon:e.$q.iconSet.uploader.clear,flat:"",dense:"",onClick:d.abort},{default:T(()=>[A(i,null,{default:T(()=>[Oe(M(e.$q.lang.vui.uploader.clear),1)]),_:1})]),_:2},1032,["icon","onClick"])):D("",!0),n.globalCanAddFiles(d.files)&&!d.readonly?($(),O(r,{key:3,type:"a",icon:e.$q.iconSet.uploader.add,flat:"",dense:""},{default:T(()=>[A(c),A(i,null,{default:T(()=>[Oe(M(e.$q.lang.vui.uploader.add),1)]),_:1})]),_:1},8,["icon"])):D("",!0)])])}]),1040,["url","field-name","multiple","max-files","onUploaded","readonly"])}var An=C(qn,[["render",Mn]]),jn={inserted:function(e,t,o){var a=t.expression;if(!window.watcherUpdates&&(window.watcherUpdates={originalDocumentTitle:document.title,updates_detected:!1,acceptedUpdates:function(){window.watcherUpdates.updates_detected=!1,document.title=window.watcherUpdates.originalDocumentTitle},beforeWindowUnload:function(i){window.watcherUpdates.updates_detected&&(i.preventDefault(),i.returnValue=`Voulez-vous quitter cette page ? 
 Les modifications que vous avez apport\xE9es ne seront peut-\xEAtre pas enregistr\xE9es`)}},window.addEventListener("beforeunload",window.watcherUpdates.beforeWindowUnload),o.context.$root.uiMessageStack)){var s=o.context.$root.uiMessageStack,n=s.globalErrors.length>0;for(let i of a.split(","))if(n=n||s.objectFieldErrors[i],n)break;n&&(window.watcherUpdates.updates_detected=!0)}e.addEventListener("click",window.watcherUpdates.acceptedUpdates);for(let i of a.split(","))o.context.$root.$watch("vueData."+i,function(){window.watcherUpdates.updates_detected=!0,document.title="*"+window.watcherUpdates.originalDocumentTitle},{deep:!0})},unbind:function(){window.removeEventListener("beforeunload",window.watcherUpdates.beforeWindowUnload)}},In={bind:function(e,t,o){var a=t.value;a&&!window.autofocus&&(window.autofocus=!0,o.context.$nextTick(()=>e.focus()))}},zn={update:function(e,t,o){o.context.$nextTick(()=>{!window.watcherUpdates||!window.watcherUpdates.updates_detected?e.classList.add("hidden"):e.classList.remove("hidden")})}};const se=window.Vue,Hn=window.Quasar;var Rn={created:function(e,t){const o=t.value.topOffset,a=t.value.topOffsetEl,s=t.value.leftOffset,n=t.value.leftOffsetEl,i=e.querySelector(".mini");for(var r=0;r<e.childNodes.length;r++){var l=e.childNodes[r];l.classList&&!l.classList.contains("mini")&&l.classList.add("not-mini")}se.minifyHandler=function(){var c=se.minifyComputeOffset(o,a,0,"TOP"),p=se.minifyComputeOffset(s,n,0,"LEFT"),f=i.getBoundingClientRect().height-c,u=e.getBoundingClientRect().height;window.pageYOffset>u-f?(i.classList.add("visible"),i.style.top=0,i.style.paddingTop=c+"px",i.style.paddingLeft=p+"px"):(i.classList.remove("visible"),i.style.top=-f-c+"px")},se.minifyComputeOffset=function(c,p,f,u){var h=f;if(c)h=c;else if(p){var d=document.querySelector(p);u==="LEFT"?h=d.getBoundingClientRect().width+d.getBoundingClientRect().x:u==="TOP"&&(h=d.getBoundingClientRect().height+d.getBoundingClientRect().y)}return h},window.addEventListener("scroll",se.minifyHandler),window.addEventListener("resize",Hn.throttle(se.minifyHandler,50))},updated:function(){for(var o=50;o<1e3;o+=o)setTimeout(se.minifyHandler,o)},unmounted:function(e){window.removeEventListener("scroll"),window.removeEventListener("resize");for(var t=0;t<e.childNodes.length;t++){var o=e.childNodes[t];o.classList&&o.classList.remove("not-mini")}}};const x=window.Vue,ie=window.Quasar;var Yn={created:function(e,t){x.createDebugLine=function(h,d,m,w){let _=document.createElement("div");return _.style.position=d,_.style.top=m+"px",_.style.border="none",_.style.borderTop=w+" solid 1px",_.style.width="100%",_.style.zIndex="10000",_.style.padding="0px",_.style.lineHeight="0px",_.style.fontSize="12px",_.style.color=w,_.innerHTML=h,document.querySelector("body").appendChild(_),_};const o=t.value.debug?t.value.debug:!1,a=t.value.startingOffset?t.value.startingOffset:24,s=t.value.fixedPos?t.value.fixedPos:24,n=a-s,i=t.value.scanner?t.value.scanner:s+30,r=e.querySelectorAll("a");r[0].classList.add("active");const l=ie.scroll.getScrollTarget(document.querySelector(r[0].hash));let c=[],p,f;o&&(p=x.createDebugLine("startLinear","absolute",0,"red"),f=x.createDebugLine("last","absolute",0,"red")),x.scrollSpyHandler=function(){if(o){for(var h=e,d=0,m=0;h&&!isNaN(h.offsetLeft)&&!isNaN(h.offsetTop);)d+=h.offsetLeft-h.scrollLeft,m+=h.offsetTop-h.scrollTop,h=h.offsetParent;console.log("x: "+d),console.log("y: "+m+" (startingOffset)")}window.pageYOffset>n?e.style.top||(e.style.top=s+"px",e.style.width||(e.style.width=e.getBoundingClientRect().width+"px"),e.classList.add("fixed")):e.style.top&&(e.classList.remove("fixed"),e.style.top=null,e.style.width=e.getBoundingClientRect().width+"px");for(var w=ie.scroll.getVerticalScrollPosition(l),_=x.computeBreakPoints(w),S=0;S<r.length;S++)_[S]<=w&&(S>=r.length-1||w<_[S+1])?r[S].classList.add("active"):r[S].classList.remove("active")},x.computeBlockTop=function(h){var d=[];for(let m=0;m<r.length;m++){const w=r[m].hash,_=document.querySelector(w);_&&d.push(h+_.getBoundingClientRect().top)}return d},x.scrollTo=function(h){h.preventDefault();const d=h.target.hash,m=document.querySelector(d);for(var w=ie.scroll.getVerticalScrollPosition(l)+m.getBoundingClientRect().top-i,_=ie.scroll.getVerticalScrollPosition(l),S=x.computeBlockTop(_),g=x.computeBreakPoints(_),B=0;B<r.length;B++)if(r[B].hash==d){S[B]-i<g[B+1]||!g[B+1]?w=S[B]-i:w=g[B+1]-1;break}var Q=200;ie.scroll.setVerticalScrollPosition(l,w,Q)},x.computeBreakPoints=function(h){var d=x.computeBlockTop(h);const m=window.innerHeight||document.documentElement.clientHeight,w=ie.scroll.getScrollHeight(l),S=w-m;let g=S-m+i;for(let b=1;b<r.length;b++)if(d[b]-i>g){g=d[b]-i;break}const B=S-g;var Q=[];Q.push(0);for(let b=1;b<r.length;b++)d[b]-i>g?Q[b]=g+B*(d[b]-g)/(w-g):Q[b]=d[b]-i,Q[b]=Math.round(Q[b]);if(o){for(let b=1;b<r.length;b++){var Pe;c.length<b?(Pe=x.createDebugLine("navId#"+b,"absolute",0,"red"),c.push(Pe)):Pe=c[b-1],Pe.style.top=Q[b]+i+"px"}p.style.top=g+i+"px",f.style.top=S+i+"px"}return Q},e.classList.add("scroll-spy-nav");for(var u=0;u<r.length;u++)r[u].addEventListener("click",x.scrollTo);window.addEventListener("scroll",x.scrollSpyHandler),window.addEventListener("resize",ie.throttle(x.scrollSpyHandler,50))},unmounted:function(e){e.classList.remove("scroll-spy-nav"),window.removeEventListener("scroll"),window.removeEventListener("resize");const t=e.querySelectorAll("a");for(var o=0;o<t.length;o++)t.removeEventListener("click")}};function Qn(e,t){return new Date(e)-new Date(t)}function mt(e){return Object.prototype.toString.call(e)==="[object Date]"}function ft(e){return typeof e=="number"&&isFinite(e)}const y=window.Quasar;var ht={onAjaxError:function(e){let t={type:"negative",message:"Network Error.",multiLine:!0,icon:"warning",timeout:2500};if(e){if(Object.prototype.hasOwnProperty.call(e.data,"redirect")){window.location=e.data.redirect;return}else Object.prototype.hasOwnProperty.call(e.data,"message")&&(t.message=e.data.message);if(e.status===401){t.message="UnAuthorized, you may login with an authorized account",this.$root.$emit("unauthorized",e);return}else e.status===403?t.message="Forbidden, your havn&quote;t enought rights":e.status===404?t.message="API Route is Missing or Undefined":e.status===405?t.message="API Route Method Not Allowed":e.status===422?(t.message="",Object.keys(e.data).forEach(function(a){this.$data.uiMessageStack[a]=e.data[a]}.bind(this))):e.status>=500&&(t.message="Server Error");if(e.statusText&&e.status!==422&&(t.message=e.statusText),Object.prototype.hasOwnProperty.call(e,"data")){if(Object.prototype.hasOwnProperty.call(e.data,"message")&&e.data.message&&e.data.message.length>0)t.message=e.data.message;else if(Object.prototype.hasOwnProperty.call(e.data,"globalErrors")&&e.data.globalErrors&&e.data.globalErrors.length>0){var o=this.uiMessageStackToNotify(e.data);o.forEach(function(a){this.$q.notify(a)}.bind(this)),t.message=""}}}t.message.length>0&&this.$q.notify(t)},uiMessageStackToNotify:function(e){if(e){var t=[];return Object.prototype.hasOwnProperty.call(e,"globalErrors")&&e.globalErrors&&e.globalErrors.length>0&&e.globalErrors.forEach(function(o){t.push({type:"negative",message:o,multiLine:!0,timeout:2500})}),Object.prototype.hasOwnProperty.call(e,"globalWarnings")&&e.globalWarnings&&e.globalWarnings.length>0&&e.globalWarnings.forEach(function(o){t.push({type:"warning",message:o,multiLine:!0,timeout:2500})}),Object.prototype.hasOwnProperty.call(e,"globalInfos")&&e.globalInfos&&e.globalInfos.length>0&&e.globalInfos.forEach(function(o){t.push({type:"info",message:o,multiLine:!0,timeout:2500})}),Object.prototype.hasOwnProperty.call(e,"globalSuccess")&&e.globalSuccess&&e.globalSuccess.length>0&&e.globalSuccess.forEach(function(o){t.push({type:"positive",message:o,multiLine:!0,timeout:2500})}),t}},getSafeValue:function(e,t,o){return this.$data.vueData[e]&&this.$data.vueData[e][t]?this.$data.vueData[e][t][o]:null},transformListForSelection:function(e,t,o,a){var s=this.$data.vueData[e];return a&&(s=s.filter(a)),s.map(function(n){return{value:n[t],label:n[o].toString()}})},paginationAndSortHandler:function(e){var t=e.pagination;let o=this.$data.componentStates,a=this.$data.vueData;var s=o[t.componentId].pagination;(s.sortBy!=t.sortBy||s.descending!=t.descending)&&t.sortBy&&(t.sortUrl?(t.page=1,this.$http.post(t.sortUrl,this.objectToFormData({sortFieldName:t.sortBy,sortDesc:t.descending,CTX:this.$data.vueData.CTX})).then(function(n){a[t.listKey]=n.data.model[t.listKey],this.$data.vueData.CTX=n.data.model.CTX}.bind(this))):this.$refs[t.componentId].sortMethod.apply(this.$refs[t.componentId],[a[t.listKey],t.sortBy,t.descending])),o[t.componentId].pagination=t},paginatedData:function(e,t){var a=this.$data.componentStates[t].pagination;if(a.rowsPerPage!=0){var s=(a.page-1)*a.rowsPerPage,n=a.page*a.rowsPerPage;return this.$data.vueData[e].slice(s,n)}return this.$data.vueData[e]},sortCiAi:function(e,t,o){const a=o===!0?-1:1,s=i=>i[t],n=new Intl.Collator;return e.sort((i,r)=>{let l=s(i),c=s(r);return l==null?-1*a:c==null?1*a:ft(l)===!0&&ft(c)===!0?(l-c)*a:mt(l)===!0&&mt(c)===!0?Qn(l,c)*a:typeof l=="boolean"&&typeof c=="boolean"?(l-c)*a:([l,c]=[l,c].map(p=>(p+"").toLocaleString()),n.compare(l,c)*a)})},selectedFunction:function(e,t,o){this.$data.vueData[e][t]=o.value},searchAutocomplete:function(e,t,o,a,s,n,i,r){if(n.length<2){r();return}this.$http.post(s,this.objectToFormData({terms:n,list:e,valueField:t,labelField:o,CTX:this.$data.vueData.CTX})).then(function(l){var c=l.data.map(function(p){return{value:p[t],label:p[o].toString()}});i(function(){this.$data.componentStates[a].options=c}.bind(this))}.bind(this)).catch(function(l){this.$q.notify(l.response.status+":"+l.response.statusText),i([])})},loadAutocompleteById:function(e,t,o,a,s,n,i){!this.$data.vueData[n][i]||this.$data.componentStates[a].options.filter(function(r){return r.value===this.$data.vueData[n][i]}.bind(this)).length>0||(this.$data.componentStates[a].loading=!0,this.$data.componentStates[a].options.push({value:this.$data.vueData[n][i],label:""}),this.$http.post(s,this.objectToFormData({value:this.$data.vueData[n][i],list:e,valueField:t,labelField:o,CTX:this.$data.vueData.CTX})).then(function(r){var l=r.data.map(function(c){return{value:c[t],label:c[o].toString()}});this.$data.componentStates[a].options.pop(),this.$data.componentStates[a].options=this.$data.componentStates[a].options.concat(l)}.bind(this)).catch(function(r){this.$data.componentStates[a].options.pop(),this.$q.notify(r.response.status+":"+r.response.statusText)}.bind(this)).then(function(){this.$data.componentStates[a].loading=!1}.bind(this)))},decodeDate:function(e,t){return e===y.date.formatDate(y.date.extractDate(e,"DD/MM/YYYY"),"DD/MM/YYYY")?y.date.formatDate(y.date.extractDate(e,"DD/MM/YYYY"),t):e},encodeDate:function(e,t){return e===y.date.formatDate(y.date.extractDate(e,t),t)?y.date.formatDate(y.date.extractDate(e,t),"DD/MM/YYYY"):e},decodeDatetime:function(e,t){return e===y.date.formatDate(y.date.extractDate(e,"DD/MM/YYYY HH:mm"),"DD/MM/YYYY HH:mm")?y.date.formatDate(y.date.extractDate(e,"DD/MM/YYYY HH:mm"),t):e},encodeDatetime:function(e,t){return e===y.date.formatDate(y.date.extractDate(e,t),t)?y.date.formatDate(y.date.extractDate(e,t),"DD/MM/YYYY HH:mm"):e},sortDatesAsString:function(e){return function(t,o){return y.date.extractDate(t,e).getTime()>y.date.extractDate(o,e).getTime()?1:-1}},goTo:function(e){window.location=e},openModal:function(e,t,o){if(t){var a=t;if(o&&Object.keys(o).length>0){var s=Object.keys(o).map(function(n){return n+"="+o[n]}).join("&");a=a+"?"+s}this.$data.componentStates[e].srcUrl=a}this.$data.componentStates[e].opened=!0},toogleFacet:function(e,t,o){let a=this.$data.vueData;var s=!1;a[o+"_facets"].forEach(function(i){i.code===e&&(s=i.multiple)});var n=a[o+"_selectedFacets"][e];n?n.includes(t)?s?n.splice(n.indexOf(t),1):n.splice(0):n.push(t):a[o+"_selectedFacets"][e]=[t],this.search(o)},search:y.debounce(function(e){let t=this.$data.componentStates,o=this.$data.vueData;var a=e+"_selectedFacets",s=o[e+"_criteriaContextKey"],n=this.vueDataParams([s]);n.append(a,JSON.stringify(o[a]));var i=t[e+"Search"].searchUrl,r=t[e+"Search"].collectionComponentId;if(t[r].pagination&&t[r].pagination.sortBy){var l=t[r].pagination;n.append("sortFieldName",l.sortBy),n.append("sortDesc",l.descending)}this.httpPostAjax(i,n,{onSuccess:function(c){if(t[r].pagination){var p=t[r].pagination;p.page=1,p.rowsNumber=c.data.model[e+"_list"].length}}})},400),showMore:function(e){let t=this.$data.componentStates;var o=t[e].pagination.showMoreCount;o||(o=1,t[e].pagination.showMoreCount=o),t[e].pagination.rowsPerPage=t[e].pagination.rowsPerPage/o*(o+1)},vueDataToArray(e){return Array.isArray(e)?e:e?[e]:[]},vueDataToObject(e){return Array.isArray(e)?e.length==0?null:e.length==1?e[0]:e:e||null},obtainVueDataAccessor(e,t,o,a){return o!=null&&o!="null"?a!=null?{get:function(){return e.$data.vueData[t][a][o]},set:function(s){e.$data.vueData[t][a][o]=s}}:{get:function(){return e.$data.vueData[t][o]},set:function(s){e.$data.vueData[t][o]=s}}:{get:function(){return e.$data.vueData[t]},set:function(s){e.$data.vueData[t]=s}}},uploader_dragenter(e){let t=this.$data.componentStates;t[e].dragover=!0},uploader_dragleave(e){let t=this.$data.componentStates;t[e].dragover=!1},uploader_drop(e,t){var o=this.$refs[t];o.addFiles(e.dataTransfer.files)},httpPostAjax:function(e,t,o){let a=this.$data.vueData,s=this.$data.uiMessageStack,n=this.isFormData(t)?t:this.objectToFormData(t);n.append("CTX",a.CTX),this.pushPendingAction(e),this.$http.post(e,n).then(function(i){i.data.model.CTX&&(a.CTX=i.data.model.CTX),Object.keys(i.data.model).forEach(function(r){r!="CTX"&&(a[r]=i.data.model[r])}),Object.keys(i.data.uiMessageStack).forEach(function(r){s[r]=i.data.uiMessageStack[r]}),o&&o.onSuccess&&o.onSuccess.call(this,i)}.bind(this)).catch(function(i){o&&o.onError&&o.onError.call(this,i.response)}).finally(function(){this.removePendingAction(e)}.bind(this))},isPendingAction:function(e){return e?this.$data.componentStates.pendingAction.actionNames.includes(e):this.$data.componentStates.pendingAction.actionNames.length>0},pushPendingAction:function(e){this.$data.componentStates.pendingAction.actionNames.push(e)},removePendingAction:function(e){this.$data.componentStates.pendingAction.actionNames=this.$data.componentStates.pendingAction.actionNames.filter(t=>t!==e)},hasFieldsError:function(e,t,o){const a=this.$data.uiMessageStack.objectFieldErrors;if(a){var s=o!=null?e+"["+o+"]":e;return Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&Object.prototype.hasOwnProperty.call(a[s],t)&&a[s][t].length>0}return!1},getErrorMessage:function(e,t,o){const a=this.$data.uiMessageStack.objectFieldErrors;if(a){var s=o!=null?e+"["+o+"]":e;if(Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&Object.prototype.hasOwnProperty.call(a[s],t))return a[s][t].join(", ")}else return""},vueDataParams:function(e){for(var t=new FormData,o=0;o<e.length;o++){var a=e[o],s=this.$data.vueData[a];s&&typeof s=="object"&&Array.isArray(s)===!1?Object.keys(s).forEach(function(n){if(!n.startsWith("_"))if(Array.isArray(s[n])){let i=s[n];!i||i.length==0?this.appendToFormData(t,"vContext["+a+"]["+n+"]",""):i.forEach(function(r,l){i[l]&&typeof i[l]=="object"?this.appendToFormData(t,"vContext["+a+"]["+n+"]",i[l]._v_inputValue):this.appendToFormData(t,"vContext["+a+"]["+n+"]",i[l])}.bind(this))}else s[n]&&typeof s[n]=="object"?this.appendToFormData(t,"vContext["+a+"]["+n+"]",s[n]._v_inputValue):this.appendToFormData(t,"vContext["+a+"]["+n+"]",s[n])}.bind(this)):this.appendToFormData(t,"vContext["+a+"]",s)}return t},objectToFormData:function(e){const t=new FormData;return Object.keys(e).forEach(function(o){this.appendToFormData(t,o,e[o])}.bind(this)),t},appendToFormData:function(e,t,o){o!=null?e.append(t,o):e.append(t,"")},isFormData:function(e){return typeof FormData!="undefined"&&e instanceof FormData},pastePlainTextCapture(e,t){if(e.target.nodeName==="INPUT")return;let o,a;e.preventDefault(),e.originalEvent&&e.originalEvent.clipboardData.getData?(o=e.originalEvent.clipboardData.getData("text/plain"),this.$refs[t].runCmd("insertText",o)):e.clipboardData&&e.clipboardData.getData?(o=e.clipboardData.getData("text/plain"),this.$refs[t].runCmd("insertText",o)):window.clipboardData&&window.clipboardData.getData&&(a||(a=!0,this.$refs[t].runCmd("ms-pasteTextOnly",o)),a=!1)},editorHandlerFixHelper(e,t,o,a,s,n){if(n.hasParents(e,!0))if(s.runCmd("formatBlock",a),n.range.commonAncestorContainer.hasChildNodes()){for(var r=!1,l=n.range.startContainer;l&&l!==n.el&&l.parentNode!==n.range.commonAncestorContainer;)l=l.parentNode;for(var c=n.range.endContainer;c&&c!==n.el&&c.parentNode!==n.range.commonAncestorContainer;)c=c.parentNode;n.range.commonAncestorContainer.childNodes.forEach(function(p){p===l&&(r=!0),r&&(p.outerHTML=p.outerHTML.replace(t,"")),p===c&&(r=!1)})}else for(var i=n.selection.focusNode.parentNode;i&&i!==n.el;)e.includes(i.nodeName.toLowerCase())&&(i.outerHTML=i.outerHTML.replace(t,"")),i=i.parentNode;else s.runCmd("formatBlock",o)},editorHandlerBlockquoteFix(e,t,o){this.editorHandlerFixHelper(["blockquote"],/<\/?blockquote[^>]*\/?>/g,"blockquote","div",t,o)},editorHandlerParagrapheFix(e,t,o){this.editorHandlerFixHelper(["h1","h2","h3","h4","h5","h6","h7","h8","h9"],/<\/?h[1-9][^>]*\/?>/g,"div","div",t,o)}},Gn={comments:{title:"Comments",inputLabel:"Insert here a comment",actionlabel:"Publish",cancel:"Cancel",save:"Save"},chatbot:{errorMessage:"An error occured sending the message",tryAgain:"Try again",suggestedAnswers:"Suggested answers",inputPlaceHolder:"Enter here a message",restartMessage:"Conversation is restarting"},facets:{showAll:"Show all",showLess:"Show less"},notifications:{days:"days",hours:"hours",minutes:"min",seconds:"s"},commands:{globalPlaceholder:"Type / to show all available commands",executeCommand:"Press Enter to execute command",linkLabel:"Show details"},uploader:{clear_all:"Clear All",removeUploaded:"Remove Uploaded Files",remove:"Remove",add:"Pick Files",upload:"Upload Files",clear:"Abort Upload"},handles:{placeholder:"Enter a handle : format is type/code"}},Jn={comments:{title:"Commentaires",inputLabel:"Ins\xE9rer un commentaire ici",actionlabel:"Publier",cancel:"Annuler",save:"Sauver"},chatbot:{errorMessage:"Une erreur est survenue lors de l'envoi du message",tryAgain:"Essayez de nouveau",suggestedAnswers:"R\xE9ponses sugg\xE9r\xE9es",inputPlaceHolder:"Ecrire un message",restartMessage:"Red\xE9marrage de la conversation"},facets:{showAll:"Voir plus",showLess:"Voir moins"},notifications:{days:"jours",hours:"heures",minutes:"min",seconds:"s"},commands:{globalPlaceholder:"Taper / pour afficher les commandes disponibles",executeCommand:"Appuyer sur entr\xE9e pour executer la commande",linkLabel:"Voir les d\xE9tails"},uploader:{clear_all:"Annuler tous",removeUploaded:"Supprimer tous",remove:"Supprimer",add:"Ajouter un fichier",upload:"Envoyer",clear:"Annuler"},handles:{placeholder:"Entrer un handle de la forme type/code"}},Ge={getBoundMethods:function(e,t){let o={};return Object.keys(t).forEach(a=>o[a]=t[a].bind(e)),o},install:function(e,t){if(e.component("v-chatbot",Dt),e.component("v-commands",Mt),e.component("v-comments",Yt),e.component("v-extensions-store",no),e.component("v-facets",lo),e.component("v-geopoint-input",go),e.component("v-handles",qo),e.component("v-json-editor",Oo),e.component("v-notifications",zo),e.component("v-map",Ko),e.component("v-map-layer",pn),e.component("v-tree",Vn),e.component("v-file-upload",An),e.directive("alert-unsaved-updates",jn),e.directive("autofocus",In),e.directive("if-unsaved-updates",zn),e.directive("minify",Rn),e.directive("scroll-spy",Yn),!t.axios){console.error("You have to install axios");return}e.axios=t.axios,e.$http=t.axios,Object.defineProperties(e.config.globalProperties,{axios:{get(){return t.axios}},$http:{get(){return t.axios}},$vui:{get(){return Ge.getBoundMethods(this,ht)}}})},methods:ht,initData:function(e,t){e.vueData=t.vueData,e.componentStates=t.componentStates,e.uiMessageStack=t.uiMessageStack,e.vuiLang=t.vuiLang},lang:{enUS:Gn,fr:Jn}};return window&&(window.VertigoUi=Ge),Ge});
